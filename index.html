<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Care Compass Cymru</title>
  <meta name="apple-mobile-web-app-capable" content="yes"/>

  <style>
    :root{
      --red:#c8102e;
      --green:#007a3d;
      --white:#ffffff;

      --bg1:#fff7f7;
      --bg2:#f4fff8;

      --card:#ffffff;
      --line:#e5e7eb;
      --text:#0f172a;
      --muted:#475569;

      --shadow: 0 1px 10px rgba(15,23,42,.10);
      --shadow2: 0 14px 34px rgba(15,23,42,.14);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; color:var(--text);
      font-family:-apple-system,system-ui,Arial;
      background:
        radial-gradient(900px 650px at 10% 0%, rgba(200,16,46,.10), transparent 65%),
        radial-gradient(900px 650px at 90% 0%, rgba(0,122,61,.12), transparent 65%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
    }
    header{
      position:sticky; top:0; z-index:10;
      padding:14px;
      background:rgba(255,255,255,.92);
      backdrop-filter: blur(10px);
      border-bottom:3px solid rgba(200,16,46,.35);
    }
    .brandbar{
      height:6px;
      border-radius:999px;
      background:linear-gradient(90deg, var(--red), var(--white), var(--green));
      box-shadow:var(--shadow);
      margin-bottom:10px;
    }
    h1{margin:0 0 10px;font-size:18px}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}

    button{
      border:none; border-radius:14px;
      padding:10px 12px; cursor:pointer;
      background:#fff; box-shadow:var(--shadow);
      font-size:14px;
    }
    button.primary{
      color:#fff;
      background:linear-gradient(135deg,var(--red),#ff4d6d);
      box-shadow:var(--shadow2);
    }
    button.secondary{
      color:#fff;
      background:linear-gradient(135deg,var(--green),#34d399);
    }
    button.ghost{
      border:1px solid rgba(229,231,235,.95);
      box-shadow:0 1px 4px rgba(15,23,42,.08);
      background:#fff;
    }
    button.danger{
      color:#fff;
      background:linear-gradient(135deg,#fb7185,var(--red));
    }
    button:active{transform:scale(.98)}

    input{
      width:100%;
      border:1px solid rgba(229,231,235,.95);
      border-radius:14px;
      padding:10px 12px;
      background:#fff; box-shadow:var(--shadow);
      font-size:14px;
      outline:none;
    }
    input:focus{
      border-color: rgba(0,122,61,.45);
      box-shadow: 0 0 0 4px rgba(0,122,61,.12), var(--shadow);
    }

    main{padding:14px;max-width:1050px;margin:0 auto}

    .card{
      background:var(--card);
      border:1px solid rgba(229,231,235,.95);
      border-radius:var(--radius);
      padding:12px;
      box-shadow:var(--shadow);
    }
    .muted{color:var(--muted);font-size:12px;line-height:1.35rem}
    .title{font-weight:900;font-size:15px}
    .kicker{font-size:11px;color:var(--muted)}
    .hr{border:none;border-top:1px solid rgba(229,231,235,.95);margin:12px 0}

    .pillrow{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .pill{
      font-size:12px;padding:6px 10px;border-radius:999px;
      border:1px solid rgba(229,231,235,.95);
      background:linear-gradient(180deg,#fff,#f8fafc);
      box-shadow:0 1px 4px rgba(15,23,42,.06);
    }

    /* Home big tiles */
    .tileGrid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px}
    @media(max-width:520px){.tileGrid{grid-template-columns:1fr}}
    .tile{
      padding:12px;border-radius:18px;
      border:1px solid rgba(229,231,235,.95);
      background:linear-gradient(180deg,#fff,#fafafa);
      box-shadow:var(--shadow);
      cursor:pointer;
      position:relative;overflow:hidden;
    }
    .tile::before{
      content:"";
      position:absolute;left:0;top:0;bottom:0;width:6px;
      background:linear-gradient(180deg, var(--red), var(--green));
      opacity:.75;
    }
    .sub{font-size:12px;color:var(--muted);margin-top:4px}

    /* Lists */
    .list{margin-top:10px}
    .listItem{
      padding:10px;border-radius:16px;border:1px solid rgba(229,231,235,.95);
      background:#fff; box-shadow:0 1px 4px rgba(15,23,42,.06);
      cursor:pointer;
      margin-bottom:8px;
    }
    .listTop{display:flex;justify-content:space-between;gap:8px;align-items:flex-start}
    .badge{
      font-size:12px;padding:6px 10px;border-radius:999px;
      background:#fff;border:1px solid rgba(229,231,235,.95);box-shadow:0 1px 4px rgba(15,23,42,.08)
    }

    details{
      border:1px solid rgba(229,231,235,.95);
      border-radius:16px;
      background:#fff;
      box-shadow:0 1px 4px rgba(15,23,42,.06);
      margin-bottom:10px;
      overflow:hidden;
    }
    summary{
      list-style:none;
      cursor:pointer;
      padding:10px 12px;
      font-weight:900;
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
    }
    summary::-webkit-details-marker{display:none}
    .countPill{
      font-size:12px;padding:6px 10px;border-radius:999px;
      border:1px solid rgba(229,231,235,.95);
      background:linear-gradient(135deg, rgba(200,16,46,.08), rgba(0,122,61,.08));
    }
    .catInner{padding:10px 12px}

    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .tab{
      padding:8px 10px;border-radius:999px;
      border:1px solid rgba(229,231,235,.95);
      background:#fff; box-shadow:0 1px 4px rgba(15,23,42,.08);
      cursor:pointer; user-select:none; font-size:13px;
    }
    .tab.on{
      border-color: rgba(0,122,61,.45);
      background: linear-gradient(135deg, rgba(200,16,46,.10), rgba(0,122,61,.10));
      font-weight:900;
    }

    .callout{
      border:1px solid rgba(0,122,61,.25);
      background:rgba(0,122,61,.08);
      padding:10px;border-radius:16px;
      margin-top:10px;
    }
    .dangerBox{
      border:1px solid rgba(200,16,46,.25);
      background:rgba(200,16,46,.08);
      padding:10px;border-radius:16px;
      margin-top:10px;
    }

    /* Time log rows */
    .timelineItem{
      padding:10px;border-radius:16px;border:1px solid rgba(229,231,235,.95);
      background:#fff; box-shadow:0 1px 4px rgba(15,23,42,.06);
      margin-bottom:8px;
    }
    .timelineTop{display:flex;justify-content:space-between;gap:8px;align-items:flex-start}
    .timeTag{font-weight:900}
    .smallActions{display:flex;gap:6px;flex-wrap:wrap;justify-content:flex-end}
    .smallActions button{padding:8px 10px;border-radius:12px;font-size:13px;box-shadow:0 1px 4px rgba(15,23,42,.08)}

    #listView{display:block}
    #detailView{display:none}
  </style>
</head>

<body>
<header>
  <div class="brandbar"></div>
  <h1>üß≠ Care Compass Cymru</h1>

  <!-- Only working buttons -->
  <div class="row" id="topNav">
    <button id="navHome" class="primary">Home</button>
    <button id="navAll" class="ghost">All situations</button>
    <button id="navFav" class="ghost">‚≠ê</button>
    <button id="navPaper" class="ghost">Paperwork</button>
    <button id="navLaw" class="ghost">Legislation</button>
  </div>

  <!-- Detail header -->
  <div class="row" id="detailNav" style="display:none;">
    <button id="backBtn" class="primary">‚Üê Back</button>
    <button id="copyBtn" class="secondary">Copy</button>
    <button id="favBtn" class="ghost">‚òÜ Favourite</button>
  </div>
</header>

<main>
  <!-- LIST VIEW -->
  <div id="listView" class="card">
    <div class="title" id="listTitle">Home</div>
    <div class="muted" id="listSub">Search a situation, or use a quick tile.</div>

    <div style="margin-top:10px">
      <input id="search" placeholder="Search: missing, disclosure, self-harm, police, meds, restraint‚Ä¶"/>
    </div>

    <div class="list" id="searchResults" style="display:none;"></div>

    <div id="homeTiles" style="margin-top:12px;">
      <div class="kicker"><b>12 Quick Tiles</b></div>
      <div class="tileGrid" id="tileGrid"></div>
    </div>

    <div id="allCats" style="display:none; margin-top:12px;"></div>
    <div id="favList" style="display:none; margin-top:12px;"></div>
    <div id="paperList" style="display:none; margin-top:12px;"></div>
    <div id="lawList" style="display:none; margin-top:12px;"></div>
  </div>

  <!-- DETAIL VIEW -->
  <div id="detailView" class="card">
    <div class="title" id="detailTitle">‚Äî</div>
    <div class="muted" id="detailKicker">‚Äî</div>
    <div class="pillrow" id="detailTags"></div>

    <div class="tabs" id="detailTabs"></div>
    <hr class="hr"/>
    <div id="detailBody"></div>

    <hr class="hr"/>
    <div class="callout">
      <div class="kicker"><b>Disclaimer</b></div>
      <div class="muted">
        Policy-neutral prompt tool only. Always follow your organisation‚Äôs policies/procedures and seek manager/on-call guidance.
        If there is immediate risk to life or serious harm, call emergency services.
      </div>
    </div>
  </div>
</main>

<script>
/** ==========================
 *  DATA: situations (starter library)
 *  Add more by duplicating an object below.
 *  ========================== */
const SITUATIONS = [
  // Safeguarding & Immediate Risk
  mk("üö® Missing from care", "Safeguarding & Immediate Risk",
    ["safeguarding","recording"], ["missing","absent","unauthorised","police","return"],
    {
      what:["Whereabouts unknown/absent without permission. Risk increases over time."],
      doNow:[
        "Follow missing-from-care protocol and dynamic risk assess.",
        "Attempt contact calmly; check agreed safe locations if policy allows.",
        "Escalate to manager/on-call early; police/EDT threshold per procedure.",
        "Plan a supportive welcome-back approach and immediate safety check on return."
      ],
      support:[
        "Keep messages short, calm and safety-focused (avoid threats).",
        "On return: offer drink/food, calm space, supportive check-in before consequences."
      ],
      record:[
        "Time last seen, clothing, phone status, vulnerabilities, likely locations/associates.",
        "Chronology of actions with exact times + rationale for escalation/police decisions.",
        "Return details: child‚Äôs voice, presentation, safeguarding concerns and follow-up actions."
      ],
      inform:["Manager/on-call","Police if threshold met","SW/EDT as required by plan/policy"],
      timeframes:["Record in real time where possible; escalate immediately if risk rises."],
      reportPrompts:[
        { title:"Copy-ready Missing Timeline", text:
`LAST SEEN (time/location):
CLOTHING/ITEMS:
RISK FACTORS:
ACTIONS (time-stamped):
- HH:MM ‚Äì
- HH:MM ‚Äì
CONTACT ATTEMPTS (times/outcomes):
ESCALATION (manager/on-call, police/EDT) + refs:
RETURN DETAILS (time/presentation/child‚Äôs voice):
SAFEGUARDING FOLLOW-UP:`}
      ]
    }
  ),

  mk("‚è∞ Late return to placement", "Safeguarding & Immediate Risk",
    ["recording"], ["late return","curfew","overdue","missing"],
    {
      what:["Young person overdue from agreed return time; may escalate to missing depending on risk/time."],
      doNow:[
        "Check plan/curfew and known risk factors.",
        "Attempt contact calmly; check agreed safe locations if permitted.",
        "Dynamic risk assess as time increases; escalate to manager/on-call at threshold.",
        "Move into missing protocol if whereabouts unknown or risk increases."
      ],
      support:[
        "Prioritise safe return; avoid arguments while they‚Äôre out.",
        "On return: calm debrief and regulation support."
      ],
      record:[
        "Expected vs actual return times; contact attempts/responses with times.",
        "Risk factors and rationale for escalation."
      ],
      inform:["Manager/on-call if overdue per policy","SW/EDT if required by plan"],
      timeframes:["Same-shift recording; escalate in line with thresholds."]
    }
  ),

  mk("üó£ Safeguarding disclosure", "Safeguarding & Immediate Risk",
    ["safeguarding","recording"], ["disclosure","told","abuse","harm"],
    {
      what:["Child shares information indicating harm or risk of harm. Use safeguarding pathway; do not investigate."],
      doNow:[
        "Listen calmly; do not promise secrecy; avoid leading questions.",
        "Use open prompts only (e.g., ‚ÄúTell me what happened‚Äù).",
        "Prioritise immediate safety; escalate immediately to safeguarding lead/manager/on-call.",
        "Follow referral pathway per local safeguarding procedures."
      ],
      support:[
        "Validate feelings and reassure: they‚Äôve done the right thing telling you.",
        "Offer calm space and simple choices; explain next steps age-appropriately."
      ],
      record:[
        "Verbatim key phrases where possible; date/time/location; who present.",
        "Actions taken and who informed (times/outcomes).",
        "Child presentation and any immediate safety actions."
      ],
      inform:["Safeguarding lead/manager/on-call","SW/EDT per safeguarding pathway"],
      timeframes:["Immediate escalation; record same shift/as close to real time as possible."],
      reportPrompts:[
        { title:"Copy-ready Disclosure Note", text:
`DATE/TIME/LOCATION:
WHO PRESENT:
WHAT WAS SAID (verbatim where possible):
CHILD PRESENTATION:
WHAT I DID IMMEDIATELY:
WHO I INFORMED (times/outcomes):
SAFEGUARDING ACTIONS/NEXT STEPS:`}
      ]
    }
  ),

  mk("üíî Self-harm concern", "Safeguarding & Immediate Risk",
    ["safeguarding","recording"], ["self harm","injury","cutting","bleeding"],
    {
      what:["Disclosure/injury/indicators of self-harm risk. May need medical help and increased supervision."],
      doNow:[
        "Prioritise safety; first aid/medical support if needed.",
        "Increase supervision per plan; remove means if safe and policy allows.",
        "Escalate to manager/on-call and follow health/safeguarding pathway."
      ],
      support:[
        "Non-judgemental language; focus on safety and coping.",
        "Offer grounding (breathing, sensory tools, hydration, quiet space)."
      ],
      record:[
        "What observed/disclosed; injuries (body map if required); triggers/context.",
        "Actions taken (first aid/advice), supervision changes, outcome.",
        "Who informed and follow-up plan."
      ],
      inform:["Manager/on-call","Health pathway as required","SW/EDT as required"],
      timeframes:["Immediate escalation if high risk; record as close to real time as possible."]
    }
  ),

  mk("üòî Suicidal thoughts / threats", "Safeguarding & Immediate Risk",
    ["safeguarding","recording"], ["suicide","suicidal","ideation","threat"],
    {
      what:["Young person expresses suicidal ideation/intent. Treat as urgent and follow crisis pathway."],
      doNow:[
        "Increase supervision and reduce access to immediate risks (policy-led).",
        "Use crisis/health pathway (111/crisis/999 depending on risk).",
        "Escalate immediately to manager/on-call; safeguarding pathway where required.",
        "Agree short-term safety plan and ensure support is continuous."
      ],
      support:[
        "Stay calm and present; validate feelings without debating/minimising.",
        "Simple language: ‚ÄúI‚Äôm glad you told me‚Äîlet‚Äôs keep you safe.‚Äù"
      ],
      record:[
        "Exact statements (verbatim), context/triggers, risk & protective factors.",
        "Actions taken + advice received (who/when), supervision changes and outcomes."
      ],
      inform:["Manager/on-call immediately","Health pathway per policy","SW/EDT as required"],
      timeframes:["Immediate escalation; record in real time where possible."],
      reportPrompts:[
        { title:"Copy-ready Crisis Record", text:
`DATE/TIME:
WHAT WAS SAID (verbatim):
PRESENTATION/RISK INDICATORS:
PROTECTIVE FACTORS:
ACTIONS TAKEN:
ADVICE RECEIVED (who/when):
SUPERVISION LEVEL:
OUTCOME/NEXT STEPS:`}
      ]
    }
  ),

  mk("üöî Police involvement", "Safeguarding & Immediate Risk",
    ["police","recording","rights"], ["police","officers","crime","reference"],
    {
      what:["Police are involved; information sharing must be proportionate and policy-led."],
      doNow:[
        "Confirm officer identity and purpose; follow confidentiality rules.",
        "Support the child and prioritise welfare; escalate to manager/on-call.",
        "Record reference numbers and key instructions/outcomes."
      ],
      support:[
        "Explain what‚Äôs happening in calm, age-appropriate language.",
        "Debrief afterwards and offer regulation support."
      ],
      record:[
        "Reason for involvement, times, reference numbers, info shared and rationale.",
        "Impact on child and follow-up actions."
      ],
      inform:["Manager/on-call","SW/placing authority as required","Safeguarding lead if concerns"],
      timeframes:["Same-shift recording; immediate escalation if safeguarding risk."]
    }
  ),

  // Behaviour & Regulation
  mk("üò° Verbal aggression", "Behaviour & Regulation",
    ["recording"], ["verbal","aggression","shouting","swearing","threats"],
    {
      what:["Verbal escalation/threats/intimidation."],
      doNow:[
        "De-escalate: calm tone, space, reduce demands, remove audience if safe.",
        "Set clear, simple boundaries without power struggles.",
        "Call for support and escalate if risk increases."
      ],
      support:[
        "Validate emotion, not harmful behaviour.",
        "Offer regulated options (quiet space, drink, grounding tools).",
        "Repair later when calm."
      ],
      record:[
        "Antecedents/triggers; key phrases where appropriate; duration/level.",
        "Support offered; what helped/didn‚Äôt; outcome."
      ],
      inform:["Manager/on-call if significant/repeated","Keyworker for pattern review"],
      timeframes:["Same shift; immediate escalation if threats become credible/imminent."]
    }
  ),

  mk("üëä Physical aggression / assault", "Behaviour & Regulation",
    ["recording","safeguarding"], ["assault","hit","kick","aggression"],
    {
      what:["Physical aggression creating risk of injury."],
      doNow:[
        "Prioritise safety: separate safely; call for support; reduce audience.",
        "Use de-escalation and safety positioning; seek medical help if needed.",
        "Escalate to manager/on-call; police threshold per policy if required."
      ],
      support:[
        "Support all involved once safe; calm space and regulation support.",
        "Plan restorative/repair steps when settled."
      ],
      record:[
        "Who involved, chronology, injuries/damage, triggers/antecedents.",
        "De-escalation attempts, decisions made, outcomes and follow-up."
      ],
      inform:["Manager/on-call","Health if injuries","Police if threshold met","SW as required"],
      timeframes:["Same shift; immediate escalation if risk rises."]
    }
  ),

  mk("üßç Physical intervention used", "Behaviour & Regulation",
    ["restrictive","recording","rights"], ["restraint","hold","intervention"],
    {
      what:["Restrictive physical intervention used to prevent harm."],
      doNow:[
        "End as soon as safe; check breathing/positioning; medical checks if needed.",
        "Debrief young person and staff when settled; complete reporting per procedure."
      ],
      support:[
        "Reassure and support regulation post-incident.",
        "Offer explanation later; focus on safety and repair."
      ],
      record:[
        "Antecedent, de-escalation attempts, type/duration, injuries.",
        "Post-incident checks/debriefs and learning points; manager review outcome."
      ],
      inform:["Manager/on-call per policy","SW/placing authority if required"],
      timeframes:["ASAP after safe; complete required reviews within policy timescales."]
    }
  ),

  mk("üß± Damage to property", "Behaviour & Regulation",
    ["recording"], ["damage","property","smash","break"],
    {
      what:["Intentional/reckless damage to property."],
      doNow:[
        "Make environment safe; remove access to further damage if possible.",
        "De-escalate; reduce audience; avoid cornering.",
        "Escalate to manager/on-call if significant damage or risk of harm."
      ],
      support:[
        "After calm: restorative approach (repair plan/accountability without shame).",
        "Offer alternatives for anger (sensory tools, exercise, time out)."
      ],
      record:[
        "What damaged, where/when, triggers/context, injuries if any.",
        "Actions taken and follow-up repairs needed."
      ],
      inform:["Manager/on-call if significant","Maintenance/landlord per procedure","SW if required"],
      timeframes:["Same shift; raise maintenance promptly."]
    }
  ),

  // Health & Medication
  mk("üíä Medication error", "Health & Medication",
    ["meds","recording"], ["med error","wrong dose","missed dose","MAR"],
    {
      what:["Medication missed/incorrect dose/time or documentation error."],
      doNow:[
        "Confirm what occurred using MAR (med/dose/time).",
        "Seek clinical advice per pathway (pharmacy/111/GP/999) and follow instructions.",
        "Escalate to manager/on-call; monitor and record observations as advised."
      ],
      support:[
        "Reassure and monitor wellbeing; explain calmly if appropriate."
      ],
      record:[
        "What happened, advice received (who/when), actions taken.",
        "Monitoring outcomes and notifications made."
      ],
      inform:["Manager/on-call","Health professionals per advice","SW/parents if required by plan/policy"],
      timeframes:["Immediate action; same-shift documentation."],
      reportPrompts:[
        { title:"Copy-ready Medication Incident", text:
`DATE/TIME:
MEDICATION (name/dose):
WHAT HAPPENED (fact):
ACTION TAKEN:
ADVICE RECEIVED (who/when):
MONITORING COMPLETED:
OUTCOME:
WHO INFORMED:`}
      ]
    }
  ),

  mk("üíä Medication refusal", "Health & Medication",
    ["meds","recording"], ["refused meds","medication refusal"],
    {
      what:["Young person refuses medication; risk depends on medication and health needs."],
      doNow:[
        "Explore reasons calmly; offer permitted choices (timing/drink/food).",
        "Check plan/guidance; do not force unless lawful/policy permits.",
        "Escalate to manager/on-call and seek health advice if high risk or repeated."
      ],
      support:[
        "Non-judgemental explanation of purpose (age-appropriate).",
        "Support control via safe choices."
      ],
      record:[
        "What offered, what child said, attempts made, outcome.",
        "Advice sought and follow-up plan."
      ],
      inform:["Manager/on-call if required","Health professional per pathway"],
      timeframes:["Same shift; immediate escalation for high-risk medication."]
    }
  ),

  mk("üß™ Substance misuse concern", "Health & Medication",
    ["safeguarding","recording"], ["drugs","substance","intoxication","using"],
    {
      what:["Suspicion or evidence of substance use/intoxication; may link to exploitation risk."],
      doNow:[
        "Assess immediate health risk; seek medical help if needed.",
        "Increase supervision; remove immediate risks (policy-led).",
        "Inform manager/on-call; consider safeguarding pathway if exploitation indicators."
      ],
      support:[
        "Stay calm and non-judgemental; prioritise health and safety.",
        "Offer hydration/rest and monitoring as advised."
      ],
      record:[
        "Observed signs/statements, times, any items found (policy handling).",
        "Actions taken, advice received, monitoring outcomes."
      ],
      inform:["Manager/on-call","Health pathway if needed","SW/EDT if safeguarding concerns"],
      timeframes:["Same shift; immediate escalation if health risk."]
    }
  ),

  // Online & Exploitation
  mk("üì± Online safety incident", "Online & Exploitation",
    ["online","safeguarding","recording"], ["online","social media","grooming","images"],
    {
      what:["Online activity creates risk (grooming, harmful content, bullying, exploitation indicators)."],
      doNow:[
        "Follow plan: adjust supervision/device access per policy without shame.",
        "Preserve evidence per procedure; avoid over-handling devices if restricted.",
        "Inform manager/on-call and follow safeguarding pathway if indicators present."
      ],
      support:[
        "Reassure and avoid blame; focus on safety and support.",
        "Agree practical steps (blocking/reporting/safer settings) per policy."
      ],
      record:[
        "Factual summary (what/when/platform), risk indicators, actions taken.",
        "Who informed and outcomes/advice."
      ],
      inform:["Manager/on-call","Safeguarding lead if indicated","SW/EDT as required"],
      timeframes:["Same shift; immediate escalation if exploitation risk."]
    }
  ),

  mk("üì∏ Inappropriate images concern", "Online & Exploitation",
    ["online","safeguarding","recording"], ["images","nudes","sexting","share"],
    {
      what:["Sharing/receiving sexual images or risky content; safeguarding response required."],
      doNow:[
        "Prioritise child safety; avoid shame language.",
        "Escalate to manager/on-call and follow online safety/safeguarding pathway.",
        "Preserve evidence per policy (do not forward/redistribute)."
      ],
      support:[
        "Reassure and keep it supportive; focus on safety and next steps.",
        "Offer calm space and trusted adult support."
      ],
      record:[
        "Factual summary without storing/resharing images in records.",
        "Actions taken, who informed, advice/outcomes."
      ],
      inform:["Manager/on-call","Safeguarding lead","SW/EDT as required"],
      timeframes:["Immediate escalation if exploitation risk."]
    }
  ),

  // Family & Contact
  mk("üöó Contact visit (challenging)", "Family & Contact",
    ["recording","rights"], ["contact","family","challenging"],
    {
      what:["Contact causes distress/concerns; follow contact plan and safeguard welfare."],
      doNow:[
        "Check contact plan (supervision/boundaries/contingency).",
        "Support the child‚Äôs emotional safety during/after contact.",
        "Escalate concerns to manager/on-call and SW per plan."
      ],
      support:[
        "Validate feelings; calm space and predictable routine after contact.",
        "Avoid blame language about family; focus on safety and support."
      ],
      record:[
        "Who attended, duration, child presentation, concerns and actions.",
        "Child‚Äôs voice; follow-up agreed."
      ],
      inform:["Manager/on-call if concerns","SW/placing authority per plan"],
      timeframes:["Same shift; immediate escalation if safeguarding concern."]
    }
  ),

  // Education & Routine
  mk("üéí School refusal", "Education & Routine",
    ["recording"], ["school refusal","not going","anxiety"],
    {
      what:["Refusal to attend education; may link to anxiety, bullying, sleep or contact."],
      doNow:[
        "Explore barriers calmly; reduce pressure and offer choices.",
        "Use plan strategies (partial attendance/check-in/alternative provision).",
        "Escalate patterns to keyworker/manager for review and education liaison."
      ],
      support:[
        "Validate worries; problem-solve practical steps.",
        "Reinforce effort and small wins; keep routine predictable."
      ],
      record:[
        "What offered, child‚Äôs reasons/voice, strategies tried and outcomes.",
        "Any mental health/safeguarding indicators and actions."
      ],
      inform:["Keyworker/manager","Education provider as required","SW if ongoing pattern"],
      timeframes:["Same shift; review if repeated."]
    }
  ),

  // Staff & Operational
  mk("üßë‚Äçü§ù‚Äçüßë Staffing shortfall", "Staff & Operational",
    ["recording"], ["staffing","shortfall","cover"],
    {
      what:["Staffing levels may impact supervision and safe routines."],
      doNow:[
        "Escalate to manager/on-call; implement contingency plan.",
        "Adjust activities/supervision safely and document decisions.",
        "Prioritise safeguarding and essential routines."
      ],
      support:["Explain changes to young people calmly; maintain predictability."],
      record:[
        "Staffing issue, impact, mitigations, who informed and outcome.",
        "Any changes to supervision/activity plans."
      ],
      inform:["Manager/on-call"],
      timeframes:["Record same shift; escalate immediately if safety impacted."]
    }
  )  ,mk("üß† Mental health crisis", "Safeguarding & Immediate Risk",
    ["recording"], ["crisis","panic","overwhelmed","breakdown"],
    {
      what:["Acute distress/crisis presentation. Risk can change quickly."],
      doNow:[
        "Reduce stimulation and demands; create a calm, safe space.",
        "Dynamic risk assess; increase supervision per plan if needed.",
        "Escalate to manager/on-call; seek clinical advice via pathway if required.",
        "If immediate danger to life, call emergency services."
      ],
      support:[
        "Short calm sentences; validate feelings; avoid ‚Äòwhy‚Äô questions in peak distress.",
        "Offer grounding tools, hydration, predictable routine, quiet space."
      ],
      record:[
        "Presentation, triggers/context, risk indicators & protective factors.",
        "Support offered, what helped/didn‚Äôt, supervision changes, outcomes.",
        "Advice sought (who/when) and next steps."
      ],
      inform:["Manager/on-call if significant risk","Health pathway if required","SW/EDT as required"],
      timeframes:["Same shift recording; immediate escalation if risk rises."]
    }
  )

  ,mk("üè• Hospital attendance / admission", "Safeguarding & Immediate Risk",
    ["recording"], ["hospital","a&e","admission","ward"],
    {
      what:["Child attends/admitted to hospital (physical or mental health)."],
      doNow:[
        "Follow policy for accompaniment, consent, supervision and documentation.",
        "Share essential info appropriately (health needs/meds/risks) within confidentiality rules.",
        "Inform manager/on-call and update SW/placing authority as required.",
        "Plan discharge support and safe transport."
      ],
      support:[
        "Explain steps simply; reassure; comfort items where appropriate.",
        "After: debrief, rest and regulation support."
      ],
      record:[
        "Reason, times, who accompanied, advice/outcome, any meds changes.",
        "Follow-up appointments/monitoring and handover info."
      ],
      inform:["Manager/on-call","SW/placing authority as required","Parents if plan/policy allows"],
      timeframes:["Same shift recording; prompt plan updates via management if needed."]
    }
  )

  ,mk("üöë Emergency medical incident", "Safeguarding & Immediate Risk",
    ["recording"], ["emergency","999","ambulance","first aid"],
    {
      what:["Sudden medical emergency requiring urgent response."],
      doNow:[
        "Call emergency services if required; provide first aid within training/policy.",
        "Keep area safe; reduce crowding; allocate staff roles.",
        "Inform manager/on-call as soon as practicable once immediate response is underway.",
        "Follow relevant health plans (asthma/epilepsy/allergies) if applicable."
      ],
      support:[
        "Reassure child and others; calm guidance and presence.",
        "After: emotional support and debrief."
      ],
      record:[
        "Symptoms/what happened, times, first aid given, emergency ref/outcome.",
        "Who present and actions taken; follow-up instructions and monitoring."
      ],
      inform:["Manager/on-call","Health professionals","SW/parents as required by plan/policy"],
      timeframes:["Record immediately after safe; same shift documentation."]
    }
  )

  ,mk("üíä PRN administered", "Health & Medication",
    ["meds","recording"], ["prn","as required","administered"],
    {
      what:["PRN medication given in response to symptoms/behaviour as per guidance."],
      doNow:[
        "Confirm indication and follow PRN guidance (dose/time/limits).",
        "Monitor effect and side effects; document outcomes.",
        "Escalate to manager/on-call if repeated use or poor response."
      ],
      support:[
        "Explain calmly what PRN is for and what to expect.",
        "Use non-medical coping strategies alongside (grounding, space, hydration)."
      ],
      record:[
        "Reason/indication, time/dose, who administered (per MAR).",
        "Effect observed and timeframe; any side effects.",
        "Follow-up advice sought and actions."
      ],
      inform:["Manager/on-call if repeated/concerns","Health pathway if adverse effects"],
      timeframes:["Record on MAR immediately; same shift narrative record."]
    }
  )

  ,mk("üßæ Missing medication / stock issue", "Health & Medication",
    ["meds","recording"], ["missing meds","stock","pharmacy","run out"],
    {
      what:["Medication unavailable due to stock/collection/delivery issue."],
      doNow:[
        "Check MAR and storage; confirm if dose due and what is missing.",
        "Escalate to manager/on-call; follow pharmacy/OOH process per policy.",
        "Seek clinical advice if a critical medication is missed."
      ],
      support:[
        "Reassure and explain simply if the child asks; maintain routine.",
        "Monitor wellbeing as advised."
      ],
      record:[
        "What medication/quantity missing, doses affected, actions taken and times.",
        "Advice received and outcome (replacement/collection plan)."
      ],
      inform:["Manager/on-call","Pharmacy/health pathway as required","SW/parents if policy/plan requires"],
      timeframes:["Same shift recording; immediate action for critical meds."]
    }
  )

  ,mk("üßç‚Äç‚ôÇÔ∏è Absconding during activity", "Safeguarding & Immediate Risk",
    ["safeguarding","recording"], ["abscond","ran off","community","activity"],
    {
      what:["Young person runs off during community activity. Immediate safety response needed."],
      doNow:[
        "Maintain safety of others; allocate staff roles per policy.",
        "Attempt safe visual tracking without placing staff/others at risk.",
        "Escalate to manager/on-call; follow missing protocol if not located promptly.",
        "Consider police threshold based on vulnerability and risk."
      ],
      support:[
        "When found: calm, safety-focused tone; avoid confrontation in public.",
        "After: debrief and regulation support; plan repair/learning."
      ],
      record:[
        "Location/time/context/trigger, actions taken with times, outcome.",
        "Rationale for escalation/police and any follow-up actions."
      ],
      inform:["Manager/on-call","SW/placing authority per policy","Police if threshold met"],
      timeframes:["Record in real time where possible; escalate quickly if unable to locate."]
    }
  )

  ,mk("üö™ Refusal to return to placement", "Safeguarding & Immediate Risk",
    ["recording"], ["refuse return","won't come back","refusal"],
    {
      what:["Young person refuses to return; risk depends on location/time/vulnerability."],
      doNow:[
        "Dynamic risk assess (where they are, who with, time, known risks).",
        "Use calm negotiation and offer choices; avoid confrontation.",
        "Escalate to manager/on-call; follow missing protocol if whereabouts unknown or risk rises."
      ],
      support:[
        "Validate feelings; offer safe compromise where policy allows.",
        "Keep requests simple; use trusted relationship support if appropriate."
      ],
      record:[
        "Context and what the young person said; support offered; times/actions.",
        "Escalation decisions and outcome; follow-up plan changes."
      ],
      inform:["Manager/on-call per policy","SW/EDT as required by plan/policy"],
      timeframes:["Same shift recording; immediate escalation if risk increases."]
    }
  )

  ,mk("üßØ Fire safety concern", "Staff & Operational",
    ["recording","safety"], ["fire","alarm","smoke","evacuation"],
    {
      what:["Fire alarm activation, smoke/smell, or fire safety concern."],
      doNow:[
        "Follow evacuation/fire procedure immediately.",
        "Account for all young people and staff; call emergency services if required.",
        "Inform manager/on-call once safe; follow re-entry rules."
      ],
      support:[
        "Reassure young people; reduce panic; return to calm routine after.",
        "Offer debrief/check-in for anyone distressed."
      ],
      record:[
        "Time, cause if known, who evacuated, headcount confirmation, outcomes.",
        "Any follow-up actions (maintenance, fire service ref)."
      ],
      inform:["Manager/on-call","Emergency services if required","Maintenance/fire safety lead"],
      timeframes:["Immediate procedure; same shift recording."]
    }
  )

  ,mk("üõ†Ô∏è Maintenance hazard", "Staff & Operational",
    ["recording","safety"], ["hazard","broken","unsafe","maintenance"],
    {
      what:["Environmental hazard (broken furniture, sharp edges, leaks, trip hazards)."],
      doNow:[
        "Make safe immediately (cordon off/remove access) within policy.",
        "Report via maintenance process; escalate to manager/on-call if urgent.",
        "Consider temporary risk controls (room changes, supervision adjustments)."
      ],
      support:["Explain changes calmly; keep routines predictable."],
      record:[
        "Hazard identified, actions taken to make safe, who informed and when.",
        "Maintenance request reference and interim controls."
      ],
      inform:["Manager/on-call if urgent","Maintenance/landlord per procedure"],
      timeframes:["Same shift reporting; urgent hazards escalated immediately."]
    }
  )

  ,mk("üßë‚Äçü§ù‚Äçüßë Bullying (in-house)", "Behaviour & Regulation",
    ["safeguarding","recording"], ["bullying","name calling","targeted","peer"],
    {
      what:["Bullying between young people (verbal, social, intimidation, online crossover)."],
      doNow:[
        "Make safe: separate, increase supervision, stop the behaviour calmly.",
        "Gather basic facts without investigating; escalate to manager/on-call for plan actions.",
        "Consider safeguarding pathway if exploitation/violence/sexual harm indicators."
      ],
      support:[
        "Support targeted young person: reassurance, calm space, safety plan.",
        "Support alleged bully: boundaries, restorative work when calm, fairness and dignity."
      ],
      record:[
        "What happened (facts), who involved, impact on young person, actions taken.",
        "Any ongoing plan actions and who was informed."
      ],
      inform:["Manager/on-call","Keyworker for plan update","SW if significant/ongoing"],
      timeframes:["Same shift recording; immediate escalation if safeguarding risk."]
    }
  )

  ,mk("üë• Peer conflict (argument)", "Behaviour & Regulation",
    ["recording"], ["argument","conflict","fall out","peer"],
    {
      what:["Conflict between young people that may escalate if unmanaged."],
      doNow:[
        "Separate if needed; reduce audience; calm tone and clear boundaries.",
        "Support each to cool off; reintroduce repair conversation later.",
        "Escalate if threats/violence risk increases."
      ],
      support:[
        "Validate feelings; help each communicate safely when calm.",
        "Use restorative approach (impact/repair) not punishment-based shaming."
      ],
      record:[
        "Trigger/context, actions taken, outcomes and any follow-up plan.",
        "Any ongoing patterns relevant to risk management."
      ],
      inform:["Manager/on-call if repeated/significant","Keyworker for pattern review"],
      timeframes:["Same shift recording."]
    }
  )

  ,mk("üèÉ Missing education provision", "Education & Routine",
    ["recording"], ["no school","education missed","not provided"],
    {
      what:["Education session not available (transport cancelled, provision closed, staffing)."],
      doNow:[
        "Inform manager/on-call and education contact per procedure.",
        "Offer alternative meaningful activity and maintain routine.",
        "Record impact and any safeguarding concerns (e.g., increased risk in community)."
      ],
      support:["Explain change simply; offer choices within routine; reduce frustration triggers."],
      record:["What was missed and why, who contacted, alternative offered, outcome."],
      inform:["Manager/on-call","Education provider as required","SW if persistent issue"],
      timeframes:["Same shift recording; escalate if repeated."]
    }
  )  ,mk("üßë‚Äç‚öñÔ∏è Allegation against staff", "Safeguarding & Immediate Risk",
    ["safeguarding","allegation","recording","rights"], ["allegation","staff","complaint","accusation"],
    {
      what:["Concern raised about staff conduct. Follow allegations/safeguarding procedure and avoid investigating yourself."],
      doNow:[
        "Ensure the young person‚Äôs immediate safety and wellbeing.",
        "Escalate immediately to manager/on-call and safeguarding lead per policy.",
        "Do not investigate unless directed; preserve evidence and maintain professional boundaries."
      ],
      support:[
        "Reassure the child they will be listened to and supported.",
        "Offer a trusted adult and calm space; avoid detailed questioning."
      ],
      record:[
        "Exact words where possible; date/time/location; who was present.",
        "Immediate actions taken and who was informed (times/outcomes).",
        "Any safety measures put in place (via management)."
      ],
      inform:["Manager/on-call immediately","Safeguarding lead per policy","SW/EDT as required by pathway"],
      timeframes:["Immediate escalation; record same shift."]
    }
  )

  ,mk("üßë‚Äç‚öñÔ∏è Allegation against another young person", "Safeguarding & Immediate Risk",
    ["safeguarding","allegation","recording"], ["allegation","peer","assault","harm"],
    {
      what:["Child alleges harm/unsafe behaviour by another young person. Requires immediate safety actions and safeguarding response."],
      doNow:[
        "Make environment safe and separate where needed (calm and proportionate).",
        "Increase supervision to prevent retaliation/re-traumatisation.",
        "Escalate immediately to manager/on-call and safeguarding lead; follow pathway.",
        "Avoid investigative questioning; preserve evidence per policy."
      ],
      support:[
        "Support reporting child: reassurance, calm space, trusted adult.",
        "Support alleged child: fairness, dignity, calm supervision and clear boundaries."
      ],
      record:[
        "What alleged (verbatim where possible), date/time, who present.",
        "Safety actions taken, supervision changes, who informed (times/outcomes).",
        "Any injuries/medical actions and immediate outcomes."
      ],
      inform:["Manager/on-call","Safeguarding lead","SW/EDT per safeguarding pathway"],
      timeframes:["Immediate escalation; record as close to real time as possible."]
    }
  )

  ,mk("üß© Missing from placement: returning with concerns", "Safeguarding & Immediate Risk",
    ["safeguarding","recording"], ["return","missing","welcome back","concerns"],
    {
      what:["Young person returns from missing/late with indicators of harm, exploitation, intoxication, injury or distress."],
      doNow:[
        "Complete immediate welfare check (injury, intoxication, distress) and seek medical support if needed.",
        "Escalate to manager/on-call and follow safeguarding pathway if indicators present.",
        "Preserve evidence per policy; plan safe, supportive debrief when regulated."
      ],
      support:[
        "Non-judgemental welcome back; offer drink/food/shower/rest.",
        "Validate feelings; avoid interrogation; offer trusted adult check-in."
      ],
      record:[
        "Presentation on return, child‚Äôs voice, any disclosures/injuries, immediate actions taken.",
        "Safeguarding decisions, who informed and outcomes."
      ],
      inform:["Manager/on-call","Safeguarding lead if indicated","SW/EDT as required"],
      timeframes:["Immediate escalation if safeguarding indicators; same shift recording."]
    }
  )

  ,mk("üß™ Alcohol intoxication", "Health & Medication",
    ["safeguarding","recording"], ["alcohol","drunk","intoxicated","vomit"],
    {
      what:["Signs of alcohol intoxication; risk includes aspiration, injuries, vulnerability and exploitation."],
      doNow:[
        "Assess safety and level of consciousness; seek medical help if red flags (unresponsive, breathing issues, repeated vomiting).",
        "Increase supervision; keep airway safe; monitor as advised.",
        "Escalate to manager/on-call; consider safeguarding pathway if linked to exploitation."
      ],
      support:[
        "Calm, non-judgemental approach; hydration only if safe/alert.",
        "Reassure and reduce stimulation; offer rest and monitoring."
      ],
      record:[
        "Observed signs, times, any substances disclosed, actions taken and advice received.",
        "Monitoring completed and outcomes; safeguarding considerations."
      ],
      inform:["Manager/on-call","Health pathway if needed","SW/EDT if safeguarding concerns"],
      timeframes:["Immediate if medical risk; same shift recording."]
    }
  )

  ,mk("üß™ Suspected overdose / poisoning", "Safeguarding & Immediate Risk",
    ["safeguarding","recording"], ["overdose","poisoning","tablets","unknown substance"],
    {
      what:["Suspected overdose or ingestion of unknown substance‚Äîtreat as emergency."],
      doNow:[
        "Call emergency services immediately if suspected overdose/poisoning.",
        "Follow first aid guidance and keep child safe; do not induce vomiting.",
        "Escalate to manager/on-call; preserve packaging/evidence per policy."
      ],
      support:[
        "Reassure; keep calm; stay with the young person.",
        "Support peers who witnessed incident with reassurance and boundaries."
      ],
      record:[
        "What suspected ingested, times, symptoms, actions taken, emergency ref/outcome.",
        "Who informed and follow-up plan."
      ],
      inform:["Emergency services","Manager/on-call","SW/EDT as required"],
      timeframes:["Immediate; record after safe/as close to real time as possible."]
    }
  )

  ,mk("üß∑ Weapon / sharp found", "Safeguarding & Immediate Risk",
    ["safety","recording"], ["weapon","knife","sharp","blade"],
    {
      what:["Weapon/sharp found in the home or on a young person."],
      doNow:[
        "Prioritise safety: do not escalate risk; follow your policy for safe handling and staff support.",
        "Increase supervision and remove access to others if required.",
        "Escalate immediately to manager/on-call; consider police threshold per policy."
      ],
      support:[
        "Calm, non-confrontational approach; focus on safety not blame.",
        "Offer regulated space and supportive check-in later."
      ],
      record:[
        "What found, where, when, who present, actions taken and rationale.",
        "Outcome and any safeguarding actions."
      ],
      inform:["Manager/on-call immediately","Police if threshold met","SW/EDT if safeguarding concerns"],
      timeframes:["Immediate escalation; same shift recording."]
    }
  )

  ,mk("üõèÔ∏è Night-time disturbance / awake all night", "Education & Routine",
    ["recording"], ["sleep","awake","night","insomnia"],
    {
      what:["Sleep disruption impacting regulation, routines and risk."],
      doNow:[
        "Follow night routine plan; reduce stimulation; encourage safe rest.",
        "Monitor wellbeing; escalate if linked to crisis, self-harm or missing risk.",
        "Plan day adjustments (school/appointments) proportionately."
      ],
      support:[
        "Offer calm environment, warm drink if appropriate, grounding/sensory strategies.",
        "Avoid punitive responses; reinforce routine."
      ],
      record:[
        "Sleep pattern, triggers, support offered, impact on next day.",
        "Any risk indicators and escalations."
      ],
      inform:["Keyworker/manager if persistent","Health pathway if needed"],
      timeframes:["Same shift; review if pattern repeats."]
    }
  )

  ,mk("üçΩÔ∏è Refusal to eat / concerns about nutrition", "Health & Medication",
    ["recording"], ["refusing food","not eating","nutrition","eating"],
    {
      what:["Reduced intake/refusal to eat; may link to anxiety, control, illness or eating difficulties."],
      doNow:[
        "Check immediate health risk and follow any health plans.",
        "Offer small choices and safe options; monitor fluids.",
        "Escalate to manager/on-call if risk increases or pattern persists."
      ],
      support:[
        "Non-judgemental approach; avoid power struggles.",
        "Offer predictable meal routine and supportive encouragement."
      ],
      record:[
        "What offered/consumed, child‚Äôs voice, context/triggers, actions taken.",
        "Any health advice sought and follow-up."
      ],
      inform:["Manager/on-call if persistent/risk","Health professional if indicated","SW if plan requires"],
      timeframes:["Record daily; escalate if rapid weight/health concerns."]
    }
  )

  ,mk("üöø Refusal of personal hygiene", "Education & Routine",
    ["recording"], ["hygiene","shower","refusal","self care"],
    {
      what:["Refusal to engage in hygiene/self-care; may link to trauma, sensory needs, mood or routines."],
      doNow:[
        "Offer choices and privacy; avoid confrontation.",
        "Use plan strategies (timing, preferred products, sensory adjustments).",
        "Escalate persistent concerns to keyworker/manager for review."
      ],
      support:[
        "Respect dignity and autonomy; small steps and encouragement.",
        "Reinforce routine and strengths."
      ],
      record:[
        "Support offered, response, any barriers identified, outcomes.",
        "Any impact on health/social/education."
      ],
      inform:["Keyworker/manager if persistent","Health if skin/medical concerns"],
      timeframes:["Record same shift; review if pattern persists."]
    }
  )

  ,mk("üè† Missing property / theft allegation", "Staff & Operational",
    ["recording"], ["missing property","theft","stolen"],
    {
      what:["Items reported missing or theft alleged. Needs calm, factual response."],
      doNow:[
        "Support the child; avoid accusations; follow property procedure.",
        "Encourage systematic search and record what has been checked.",
        "Escalate to manager/on-call if allegation serious or conflict risk."
      ],
      support:[
        "Validate feelings; focus on practical steps and fairness.",
        "Consider restorative conversation later if appropriate."
      ],
      record:[
        "What missing, last known location/time, steps taken, outcome.",
        "Any conflict risks and actions taken."
      ],
      inform:["Manager/on-call if serious/repeated","SW if required by policy"],
      timeframes:["Same shift recording; update if item found."]
    }
  )
];

  const LAWS = [
const LAWS = [
  {
    title: "Social Services and Well-being (Wales) Act 2014",
    url: "https://www.legislation.gov.uk/anaw/2014/4/contents",
    note: "Primary framework for wellbeing, safeguarding, and social care duties in Wales."
  },
  {
    title: "Regulation and Inspection of Social Care (Wales) Act 2016",
    url: "https://www.legislation.gov.uk/anaw/2016/2/contents/enacted",
    note: "Regulation and inspection framework for social care in Wales."
  },
  {
    title: "Regulated Services (Service Providers and Responsible Individuals) (Wales) Regulations 2017",
    url: "https://www.legislation.gov.uk/wsi/2017/1264/contents/made",
    note: "Key regulatory requirements for providers and Responsible Individuals."
  },
  {
    title: "Wales Safeguarding Procedures",
    url: "https://www.safeguarding.wales/",
    note: "All-Wales safeguarding procedures and practice guidance."
  },
  {
    title: "Children Act 1989",
    url: "https://www.legislation.gov.uk/ukpga/1989/41/contents",
    note: "Key duties around child protection and welfare."
  },
  {
    title: "Children Act 2004",
    url: "https://www.legislation.gov.uk/ukpga/2004/31/contents",
    note: "Strengthens safeguarding duties and inter-agency working."
  },
  {
    title: "UN Convention on the Rights of the Child (UNCRC) ‚Äì UNICEF UK",
    url: "https://www.unicef.org.uk/what-we-do/un-convention-child-rights/",
    note: "Children‚Äôs rights framework relevant to Welsh practice."
  },
  {
    title: "Care Inspectorate Wales (CIW)",
    url: "https://careinspectorate.wales/",
    note: "Inspectorate for regulated care services in Wales."
  },
  {
    title: "Social Care Wales",
    url: "https://socialcare.wales/",
    note: "Workforce standards, codes of practice and guidance."
  }
];

/** ==========================
 *  Helpers to build items
 *  ========================== */
function mk(name, category, tags, keywords, data){
  return {
    id: uid(),
    kind: "situation",
    name, category, tags, keywords,
    fav: false,
    updated: todayISO(),
    data: {
      what: data.what || [],
      doNow: data.doNow || [],
      support: data.support || [],
      record: data.record || [],
      inform: data.inform || [],
      timeframes: data.timeframes || [],
      reportPrompts: data.reportPrompts || []
    }
  };
}
function uid(){ return Math.random().toString(16).slice(2) + Date.now().toString(16); }
function todayISO(){ return new Date().toISOString().slice(0,10); }
function esc(s){ return String(s).replace(/[&<>"']/g,c=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[c])); }

/** ==========================
 *  App state + persistence
 *  ========================== */
const KEY="ccc_companion_v1";
const saved = load();
const state = saved ?? {
  items: SITUATIONS,
  view: "home", // home | all | fav | paperwork
  selectedId: SITUATIONS[0]?.id || "",
  detailTab: "doNow",
  search: "",
  backView: "home",
  timeLogs: {}, // { itemId: { YYYY-MM-DD: [ {id,time,note} ] } }
};
if(!saved) save();

function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }
function load(){ try{ const r=localStorage.getItem(KEY); return r?JSON.parse(r):null; }catch{return null;} }

/** ==========================
 *  UI refs
 *  ========================== */
const listView = document.getElementById("listView");
const detailView = document.getElementById("detailView");
const topNav = document.getElementById("topNav");
const detailNav = document.getElementById("detailNav");

const listTitle = document.getElementById("listTitle");
const listSub = document.getElementById("listSub");
const searchEl = document.getElementById("search");
const searchResults = document.getElementById("searchResults");
const tileGrid = document.getElementById("tileGrid");
const allCats = document.getElementById("allCats");
const favList = document.getElementById("favList");
const paperList = document.getElementById("paperList");

const detailTitle = document.getElementById("detailTitle");
const detailKicker = document.getElementById("detailKicker");
const detailTags = document.getElementById("detailTags");
const detailTabs = document.getElementById("detailTabs");
const detailBody = document.getElementById("detailBody");

/** ==========================
 *  Navigation
 *  ========================== */
document.getElementById("navHome").onclick=()=>setView("home");
document.getElementById("navAll").onclick=()=>setView("all");
document.getElementById("navFav").onclick=()=>setView("fav");
document.getElementById("navPaper").onclick=()=>setView("paperwork");
document.getElementById("navLaw").onclick=()=>setView("law");

document.getElementById("backBtn").onclick=()=>{
  showList();
  setView(state.backView || "home", false);
};

document.getElementById("copyBtn").onclick=()=>copyCurrent();
document.getElementById("favBtn").onclick=()=>toggleFav();

/** ==========================
 *  Views
 *  ========================== */
function showDetail(){
  listView.style.display="none";
  detailView.style.display="block";
  topNav.style.display="none";
  detailNav.style.display="flex";
  window.scrollTo(0,0);
}
function showList(){
  detailView.style.display="none";
  listView.style.display="block";
  detailNav.style.display="none";
  topNav.style.display="flex";
  window.scrollTo(0,0);
}
function setView(v, render=true){
  state.view=v;
  save();
  if(render) renderList();
}

/** ==========================
 *  Search
 *  ========================== */
searchEl.value = state.search || "";
searchEl.oninput = (e)=>{ state.search=e.target.value; save(); renderSearch(); };

function matchItem(it, q){
  if(!q) return true;
  const hay = [it.name, it.category, (it.tags||[]).join(" "), (it.keywords||[]).join(" "), JSON.stringify(it.data||{})].join(" ").toLowerCase();
  return hay.includes(q);
}
function renderSearch(){
  const q=(state.search||"").trim().toLowerCase();
  if(!q){ searchResults.style.display="none"; searchResults.innerHTML=""; return; }
  const hits = state.items.filter(it=>matchItem(it,q)).slice(0,20);
  searchResults.style.display="block";
  searchResults.innerHTML="";
  hits.forEach(it=>{
    const row=document.createElement("div");
    row.className="listItem";
    row.innerHTML=`
      <div class="listTop">
        <div>
          <div class="title">${esc(it.name)}</div>
          <div class="sub">${esc(it.category)}</div>
        </div>
        <div class="badge">${it.fav ? "‚≠ê" : "NOW"}</div>
      </div>`;
    row.onclick=()=>openItem(it.id, state.view);
    searchResults.appendChild(row);
  });
}

/** ==========================
 *  Home 12 tiles
 *  ========================== */
const QUICK_12 = [
  "üö® Missing from care",
  "‚è∞ Late return to placement",
  "üó£ Safeguarding disclosure",
  "üíî Self-harm concern",
  "üòî Suicidal thoughts / threats",
  "üöî Police involvement",
  "üëä Physical aggression / assault",
  "üßç Physical intervention used",
  "üíä Medication error",
  "üíä Medication refusal",
  "üì± Online safety incident",
  "üéí School refusal"
];

function renderTiles(){
  tileGrid.innerHTML="";
  QUICK_12.forEach(name=>{
    const it = state.items.find(x=>x.name===name);
    if(!it) return;
    const t=document.createElement("div");
    t.className="tile";
    t.innerHTML=`<div class="title">${esc(it.name)}</div><div class="sub">${esc(it.category)}</div>`;
    t.onclick=()=>openItem(it.id, state.view);
    tileGrid.appendChild(t);
  });
}

/** ==========================
 *  All situations grouped
 *  ========================== */
const CATS = [
  "Safeguarding & Immediate Risk",
  "Behaviour & Regulation",
  "Health & Medication",
  "Family & Contact",
  "Education & Routine",
  "Online & Exploitation",
  "Staff & Operational"
];

function renderAllCats(){
  allCats.innerHTML="";
  const situations = state.items;
  const byCat = {};
  CATS.forEach(c=>byCat[c]=[]);
  situations.forEach(it=>{
    (byCat[it.category] ||= []).push(it);
  });

  CATS.forEach(cat=>{
    const items=(byCat[cat]||[]).sort((a,b)=>a.name.localeCompare(b.name));
    const det=document.createElement("details");
    const sum=document.createElement("summary");
    sum.innerHTML=`<span>${esc(cat)}</span><span class="countPill">${items.length}</span>`;
    det.appendChild(sum);

    const inner=document.createElement("div");
    inner.className="catInner";
    items.forEach(it=>{
      const row=document.createElement("div");
      row.className="listItem";
      row.innerHTML=`
        <div class="listTop">
          <div>
            <div class="title">${esc(it.name)}</div>
            <div class="sub">${esc((it.tags||[]).slice(0,4).join(" ‚Ä¢ "))}</div>
          </div>
          <div class="badge">${it.fav ? "‚≠ê" : "NOW"}</div>
        </div>`;
      row.onclick=()=>openItem(it.id, state.view);
      inner.appendChild(row);
    });

    det.appendChild(inner);
    allCats.appendChild(det);
  });
}

/** ==========================
 *  Favourites
 *  ========================== */
function renderFavs(){
  favList.innerHTML="";
  const favs = state.items.filter(x=>x.fav);
  if(!favs.length){
    favList.innerHTML=`<div class="muted">No favourites yet. Open a situation and tap ‚òÜ Favourite.</div>`;
    return;
  }
  favs.forEach(it=>{
    const row=document.createElement("div");
    row.className="listItem";
    row.innerHTML=`
      <div class="listTop">
        <div>
          <div class="title">${esc(it.name)}</div>
          <div class="sub">${esc(it.category)}</div>
        </div>
        <div class="badge">‚≠ê</div>
      </div>`;
    row.onclick=()=>openItem(it.id, state.view);
    favList.appendChild(row);
  });
}

function toggleFav(){
  const it = state.items.find(x=>x.id===state.selectedId);
  if(!it) return;
  it.fav = !it.fav;
  it.updated = todayISO();
  save();
  renderList();
  renderDetail();
}

/** ==========================
 *  Paperwork screen (simple)
 *  ========================== */
function renderPaperworkHome(){
  paperList.innerHTML="";
  const blocks = [
    {
      title:"üìå Report helper (universal structure)",
      text:
`WHAT HAPPENED (chronology with times):
CHILD‚ÄôS VOICE (key phrases):
PRESENTATION (mood, affect, behaviour):
RISK (what/level/why) + rationale:
WHAT YOU DID (support/de-escalation/boundaries):
WHO INFORMED (times/outcomes):
OUTCOME:
NEXT STEPS/HANDOVER:`
    },
    {
      title:"‚úÖ What to include (CIW-friendly)",
      text:
`‚Ä¢ Exact times and sequence
‚Ä¢ Facts not assumptions
‚Ä¢ Child‚Äôs voice (verbatim where possible)
‚Ä¢ Support offered and outcome
‚Ä¢ Risk assessment + rationale
‚Ä¢ Who you informed and when`
    },
    {
      title:"üö´ What to avoid",
      text:
`‚Ä¢ Opinion written as fact
‚Ä¢ Missing times
‚Ä¢ Blame/shame language
‚Ä¢ Over-detailing sensitive content unnecessarily`
    }
  ];

  blocks.forEach(b=>{
    const row=document.createElement("div");
    row.className="listItem";
    row.innerHTML=`
      <div class="title">${esc(b.title)}</div>
      <div class="muted" style="white-space:pre-wrap;margin-top:6px">${esc(b.text)}</div>
      <div class="row" style="margin-top:10px;justify-content:flex-end">
        <button class="secondary">Copy</button>
      </div>`;
    row.querySelector("button").onclick=()=>copyText(b.text);
    paperList.appendChild(row);
  });
}

/** ==========================
 *  List render
 *  ========================== */
function renderList(){
  // hide sections
  document.getElementById("homeTiles").style.display="none";
  allCats.style.display="none";
  favList.style.display="none";
  paperList.style.display="none";

  renderSearch();

  if(state.view==="home"){
    listTitle.textContent="Home";
    listSub.textContent="Search a situation, or use a quick tile.";
    document.getElementById("homeTiles").style.display="block";
    renderTiles();
    return;
  }
  if(state.view==="all"){
    listTitle.textContent="All situations";
    listSub.textContent="Grouped by category. Tap to open.";
    allCats.style.display="block";
    renderAllCats();
    return;
  }
  if(state.view==="fav"){
    listTitle.textContent="Favourites";
    listSub.textContent="Your saved quick references.";
    favList.style.display="block";
    renderFavs();
    return;
  }
  if(state.view==="paperwork"){
    listTitle.textContent="Paperwork";
    listSub.textContent="Copy-ready prompts for reports + CIW-friendly reminders.";
    paperList.style.display="block";
    renderPaperworkHome();
    return;
  }
}

/** ==========================
 *  Detail view (tabs + time log + report helper)
 *  ========================== */
function addTab(id,label){
  const t=document.createElement("div");
  t.className="tab" + (state.detailTab===id ? " on" : "");
  t.textContent=label;
  t.onclick=()=>{ state.detailTab=id; save(); renderDetail(); };
  detailTabs.appendChild(t);
}

function renderDetailTabs(it){
  detailTabs.innerHTML="";
  addTab("what","What");
  addTab("doNow","Do now");
  addTab("support","Support");
  addTab("record","Record");
  addTab("inform","Inform");
  addTab("timeframes","Timeframes");
  addTab("timelog","Time log");
  addTab("report","Report helper");
}

function section(title, arr){
  const wrap=document.createElement("div");
  wrap.style.marginBottom="10px";
  wrap.innerHTML = `<div class="kicker"><b>${esc(title)}</b></div>`;
  if(!arr || !arr.length){
    wrap.innerHTML += `<div class="muted">‚Äî</div>`;
    return wrap;
  }
  const ul=document.createElement("ul");
  ul.style.margin="8px 0 0 18px";
  ul.style.padding="0";
  ul.style.fontSize="13px";
  ul.style.lineHeight="1.45rem";
  arr.forEach(x=>{
    const li=document.createElement("li");
    li.textContent=x;
    ul.appendChild(li);
  });
  wrap.appendChild(ul);
  return wrap;
}

function dayKey(){ return new Date().toISOString().slice(0,10); }
function getLog(itId){
  const d=dayKey();
  state.timeLogs[itId] ||= {};
  state.timeLogs[itId][d] ||= [];
  return { day:d, list: state.timeLogs[itId][d] };
}

function renderTimeLog(it){
  const { day, list } = getLog(it.id);

  const box=document.createElement("div");
  box.className="callout";
  box.innerHTML=`<div class="kicker"><b>Time Log</b></div><div class="muted">Add time-stamped notes. Copy into your report.</div>`;
  detailBody.appendChild(box);

  const controls=document.createElement("div");
  controls.className="row";
  controls.style.margin="10px 0";
  controls.innerHTML=`
    <button id="addTime" class="secondary">‚ûï Add</button>
    <button id="copyTime" class="ghost">üìã Copy</button>
    <button id="clearTime" class="danger">Clear</button>
  `;
  detailBody.appendChild(controls);

  detailBody.appendChild(Object.assign(document.createElement("div"),{className:"muted",textContent:`Date: ${day}`}));

  if(!list.length){
    detailBody.appendChild(Object.assign(document.createElement("div"),{className:"muted",textContent:"No time notes yet."}));
  } else {
    list.forEach(entry=>{
      const row=document.createElement("div");
      row.className="timelineItem";
      row.innerHTML=`
        <div class="timelineTop">
          <div><span class="timeTag">${esc(entry.time)}</span> ‚Äî ${esc(entry.note)}</div>
          <div class="smallActions">
            <button class="ghost" data-act="edit">Edit</button>
            <button class="danger" data-act="del">Del</button>
          </div>
        </div>`;
      row.querySelector('[data-act="edit"]').onclick=()=>{
        const n=prompt("Edit note", entry.note);
        if(n===null) return;
        entry.note=(n.trim()||entry.note);
        save(); renderDetail();
      };
      row.querySelector('[data-act="del"]').onclick=()=>{
        if(!confirm("Delete this note?")) return;
        const idx=list.findIndex(x=>x.id===entry.id);
        if(idx>=0) list.splice(idx,1);
        save(); renderDetail();
      };
      detailBody.appendChild(row);
    });
  }

  document.getElementById("addTime").onclick=()=>{
    const note=prompt("What happened?", "");
    if(note===null) return;
    const text=note.trim();
    if(!text) return;
    list.push({ id: uid(), time: new Date().toTimeString().slice(0,5), note: text });
    save(); renderDetail();
  };
  document.getElementById("copyTime").onclick=()=>{
    const lines=list.map(x=>`${x.time} ‚Äî ${x.note}`);
    const out = `${it.name}\nDate: ${day}\n` + (lines.length?lines.join("\n"):"No entries");
    copyText(out);
  };
  document.getElementById("clearTime").onclick=()=>{
    if(!confirm("Clear today‚Äôs timeline?")) return;
    state.timeLogs[it.id][day]=[];
    save(); renderDetail();
  };
}

function renderReportHelper(it){
  const d=it.data||{};
  const wrapper=document.createElement("div");
  wrapper.className="callout";
  wrapper.innerHTML=`<div class="kicker"><b>Report Helper</b></div><div class="muted">Use these prompts to write quickly and consistently.</div>`;
  detailBody.appendChild(wrapper);

  // Situation-specific prompts
  (d.reportPrompts||[]).forEach(p=>{
    const row=document.createElement("div");
    row.className="listItem";
    row.innerHTML=`
      <div class="title">${esc(p.title)}</div>
      <div class="muted" style="white-space:pre-wrap;margin-top:6px">${esc(p.text)}</div>
      <div class="row" style="margin-top:10px;justify-content:flex-end">
        <button class="secondary">Copy</button>
      </div>`;
    row.querySelector("button").onclick=()=>copyText(p.text);
    detailBody.appendChild(row);
  });

  // Universal prompt
  const universal =
`TIME/DATE:
LOCATION:
WHO PRESENT:
WHAT HAPPENED (chronology):
CHILD‚ÄôS VOICE (key phrases):
PRESENTATION (mood/behaviour):
RISK (what/level/why):
WHAT YOU DID (support/de-escalation):
OUTCOME:
WHO INFORMED (times/outcomes):
NEXT STEPS/HANDOVER:`;
  const uni=document.createElement("div");
  uni.className="listItem";
  uni.innerHTML=`
    <div class="title">üìã Universal report template</div>
    <div class="muted" style="white-space:pre-wrap;margin-top:6px">${esc(universal)}</div>
    <div class="row" style="margin-top:10px;justify-content:flex-end">
      <button class="secondary">Copy</button>
    </div>`;
  uni.querySelector("button").onclick=()=>copyText(universal);
  detailBody.appendChild(uni);

  const include = ["Exact times and sequence","Facts not assumptions","Child‚Äôs voice","Support offered and outcome","Risk assessment + rationale","Who you informed and when"];
  const avoid = ["Opinion as fact","Missing times","Shame/blame language","Unnecessary sensitive detail"];
  detailBody.appendChild(section("‚úÖ Include", include));
  detailBody.appendChild(section("üö´ Avoid", avoid));
}

function renderDetail(){
  const it = state.items.find(x=>x.id===state.selectedId);
  if(!it) return;

  detailTitle.textContent=it.name;
  detailKicker.textContent=`${it.category} ‚Ä¢ Updated: ${it.updated || "‚Äî"}`;
  detailTags.innerHTML =
    `<span class="pill">${esc(it.category)}</span>` +
    (it.tags||[]).slice(0,4).map(t=>`<span class="pill">${esc(t)}</span>`).join("");

  renderDetailTabs(it);

  const favBtn=document.getElementById("favBtn");
  favBtn.textContent = it.fav ? "‚≠ê Favourited" : "‚òÜ Favourite";

  detailBody.innerHTML="";
  const d=it.data||{};

  if(state.detailTab==="what") detailBody.appendChild(section("What‚Äôs happening", d.what));
  if(state.detailTab==="doNow") detailBody.appendChild(section("‚úÖ Do now", d.doNow));
  if(state.detailTab==="support") detailBody.appendChild(section("üí¨ Support", d.support));
  if(state.detailTab==="record") detailBody.appendChild(section("üìù Record", d.record));
  if(state.detailTab==="inform") detailBody.appendChild(section("üìû Inform", d.inform));
  if(state.detailTab==="timeframes") detailBody.appendChild(section("‚è±Ô∏è Timeframes", d.timeframes));
  if(state.detailTab==="timelog") renderTimeLog(it);
  if(state.detailTab==="report") renderReportHelper(it);

  if(state.detailTab!=="timelog"){
    const r=document.createElement("div");
    r.className="dangerBox";
    r.innerHTML=`<div class="kicker"><b>Policy-neutral reminder</b></div><div class="muted">Follow local policy and the young person‚Äôs plans. Escalate early if risk rises.</div>`;
    detailBody.appendChild(r);
  }
}

function openItem(id, fromView){
  const it = state.items.find(x=>x.id===id);
  if(!it) return;
  state.backView = fromView || state.view || "home";
  state.selectedId = id;
  state.detailTab = "doNow";
  save();
  renderDetail();
  showDetail();
}

async function copyText(txt){
  try{ await navigator.clipboard.writeText(txt); }
  catch{ window.prompt("Copy this text:", txt); }
}

function copyCurrent(){
  const it = state.items.find(x=>x.id===state.selectedId);
  if(!it) return;
  const d=it.data||{};
  const out =
`${it.name}

WHAT:
${(d.what||[]).map(x=>"- "+x).join("\n")}

DO NOW:
${(d.doNow||[]).map(x=>"- "+x).join("\n")}

SUPPORT:
${(d.support||[]).map(x=>"- "+x).join("\n")}

RECORD:
${(d.record||[]).map(x=>"- "+x).join("\n")}

INFORM:
${(d.inform||[]).map(x=>"- "+x).join("\n")}`;
  copyText(out);
}

/** ==========================
 *  Boot
 *  ========================== */
renderList(); // initial list view
setView(state.view || "home");
</script>
</body>
</html>
